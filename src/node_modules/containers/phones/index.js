import React, {Component} from 'react';
import {connect} from 'react-redux';
import {Link} from 'react-router-dom';
import * as R from 'ramda';

import {
	fetchPhones, 
	loadMorePhones, 
	addPhoneToBasket,
	fetchCategories
} from 'actions';
import {getPhones} from 'selectors';
import Layout from 'containers/layout';

class Phones extends Component{

	componentDidMount(){
		this.props.fetchPhones();
		this.props.fetchCategories();
	}

	renderPhone (phone, index) {
		const {addPhoneToBasket} = this.props;
		const shortDescription = `${R.take(60, phone.description)}...`;

		return (
			<div className='card' key={index}>
				<div className = 'thumbnail'>
					<img
						className = 'img-thumbnail'
						src = {phone.image}
						alt = {phone.name}
					/>
				</div>
				<div className='caption'>
					<h4 className = 'pull-right'> ${phone.price}</h4>
					<h4>
						<Link to={`/phones/${phone.id}`}>
							{phone.name}
						</Link>
					</h4>
					<p>{shortDescription}</p>
					<p className='item-button'>
						<button
							className='btn btn-primary'
							onClick = {() => addPhoneToBasket(phone.id)}
						>
							Buy Now!
						</button>
						<Link
							to={`/phones/${phone.id}`}
							className='btn btn-default'
						>
							More Info
						</Link>
					</p>
				</div>
			</div>
		)
	}	

	render(){		
		const {phones} = this.props;
		return (
			<Layout>
				<div className="row card-container">
						{phones.map((phone, index) => this.renderPhone(phone, index))}	
				</div>	
				<div className='row pull-right'>
					<div className = 'col-12'>
						<button
							onClick = {loadMorePhones}
							className = 'btn btn-primary'
						>
							Load More
						</button>	
					</div>
				</div>	
			</Layout>
		)		
	}
}

const mapStateToProps = (state, ownProps) => ({
	phones : getPhones(state, ownProps)
});

const mapDispatchToProps = {
	fetchPhones,
	loadMorePhones,
	addPhoneToBasket,
	fetchCategories
};

export default connect(mapStateToProps, mapDispatchToProps) (Phones);